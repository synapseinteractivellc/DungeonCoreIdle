<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon Core Idle</title>
    <link rel="stylesheet" href="./css/main.css">
</head>
<body>
    <header>
        <h1>Dungeon Core Idle</h1>
    </header>
    
    <div class="game-container">
        <div class="main-panel">
            <div class="core-container" id="coreContainer">
                <div class="core" id="core"></div>
            </div>
            
            <div class="mana-display">
                Mana: <span id="manaDisplay">0</span>
            </div>
            <div class="mana-per-second">
                Mana per second: <span id="manaPerSecondDisplay">0.0</span>
            </div>
            
            <div class="evolution-info">
                <div>Core Type: <span id="coreTypeDisplay">Stone Core</span></div>
                <div>Evolution Progress:</div>
                <div class="evolution-progress">
                    <div class="evolution-bar" id="evolutionBar"></div>
                </div>
            </div>
        </div>
        
        <div class="side-panel">
            <div class="section-title">Dungeon Features</div>
            <ul class="feature-list" id="featureList">
                <!-- Features will be dynamically added here -->
            </ul>
        </div>
    </div>
    
    <footer>
        <p>Dungeon Core Idle - Developed by Synapse Interactive LLC</p>
        <p>Inspired by dungeon core literature including Divine Dungeon and Blue Core</p>
    </footer>
    
    <script>
        // Game state
        const game = {
            mana: 0,
            totalMana: 0,
            manaPerClick: 1,
            manaPerSecond: 0,
            coreLevel: 1,
            coreType: 'Stone Core',
            evolutionProgress: 0,
            evolutionThreshold: 1000,
            features: [
                {
                    id: 'manaVein',
                    name: 'Mana Vein',
                    description: 'A small crack in the earth that leaks mana.',
                    baseCost: 10,
                    baseEffect: 0.1,
                    count: 0,
                    unlocked: true
                },
                {
                    id: 'crystalFormation',
                    name: 'Crystal Formation',
                    description: 'Small crystals that attract ambient mana.',
                    baseCost: 50,
                    baseEffect: 0.5,
                    count: 0,
                    unlocked: true
                },
                {
                    id: 'manaPool',
                    name: 'Mana Pool',
                    description: 'A small pool of liquid mana that slowly generates more mana.',
                    baseCost: 200,
                    baseEffect: 2,
                    count: 0,
                    unlocked: true
                },
                {
                    id: 'fungalGrowth',
                    name: 'Fungal Growth',
                    description: 'Magical fungi that convert organic matter into mana.',
                    baseCost: 500,
                    baseEffect: 5,
                    count: 0,
                    unlocked: false,
                    unlockAt: 100 // Total mana required to unlock
                }
            ]
        };
        
        // DOM Elements
        const coreElement = document.getElementById('core');
        const coreContainer = document.getElementById('coreContainer');
        const manaDisplay = document.getElementById('manaDisplay');
        const manaPerSecondDisplay = document.getElementById('manaPerSecondDisplay');
        const featureList = document.getElementById('featureList');
        const coreTypeDisplay = document.getElementById('coreTypeDisplay');
        const evolutionBar = document.getElementById('evolutionBar');
        
        // Helper functions
        function formatNumber(num) {
            if (num < 1000) return num.toFixed(1);
            if (num < 1000000) return (num / 1000).toFixed(2) + 'K';
            return (num / 1000000).toFixed(2) + 'M';
        }
        
        function calculateFeatureCost(feature) {
            return Math.floor(feature.baseCost * Math.pow(1.15, feature.count));
        }
        
        function calculateFeatureEffect(feature) {
            return feature.baseEffect * feature.count;
        }
        
        // Update the display
        function updateDisplay() {
            manaDisplay.textContent = formatNumber(game.mana);
            manaPerSecondDisplay.textContent = formatNumber(game.manaPerSecond);
            
            // Check for newly unlocked features
            game.features.forEach(feature => {
                if (!feature.unlocked && game.totalMana >= feature.unlockAt) {
                    feature.unlocked = true;
                    renderFeatures(); // Re-render the feature list
                }
            });
            
            // Update evolution progress
            const evolutionPercentage = (game.evolutionProgress / game.evolutionThreshold) * 100;
            evolutionBar.style.width = evolutionPercentage + '%';
        }
        
        // Render the features list
        function renderFeatures() {
            featureList.innerHTML = '';
            
            game.features.forEach(feature => {
                if (!feature.unlocked) return;
                
                const cost = calculateFeatureCost(feature);
                const canAfford = game.mana >= cost;
                
                const li = document.createElement('li');
                li.className = 'feature-item';
                li.style.opacity = canAfford ? '1' : '0.6';
                li.onclick = () => purchaseFeature(feature);
                
                li.innerHTML = `
                    <div class="feature-name">${feature.name} <span class="feature-count">${feature.count}</span></div>
                    <div class="feature-cost">Cost: ${formatNumber(cost)} mana</div>
                    <div class="feature-effect">+${formatNumber(feature.baseEffect)} mana/sec each</div>
                `;
                
                featureList.appendChild(li);
            });
        }
        
        // Purchase a feature
        function purchaseFeature(feature) {
            const cost = calculateFeatureCost(feature);
            
            if (game.mana >= cost) {
                game.mana -= cost;
                feature.count++;
                
                // Recalculate mana per second
                calculateManaPerSecond();
                
                // Update displays
                updateDisplay();
                renderFeatures();
            }
        }
        
        // Calculate total mana per second from all sources
        function calculateManaPerSecond() {
            game.manaPerSecond = 0;
            
            game.features.forEach(feature => {
                game.manaPerSecond += calculateFeatureEffect(feature);
            });
        }
        
        // Create mana particle effect
        function createManaParticle(x, y, amount) {
            const particle = document.createElement('div');
            particle.className = 'mana-particle';
            particle.textContent = '+' + amount;
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            
            coreContainer.appendChild(particle);
            
            // Remove particle after animation completes
            setTimeout(() => {
                coreContainer.removeChild(particle);
            }, 1500);
        }
        
        // Handle core click
        coreElement.addEventListener('click', () => {
            // Get random position within the core for particle effect
            const x = Math.random() * 60 + 20;
            const y = Math.random() * 60 + 20;
            
            // Add mana
            game.mana += game.manaPerClick;
            game.totalMana += game.manaPerClick;
            game.evolutionProgress += game.manaPerClick;
            
            // Create particle effect
            createManaParticle(x, y, game.manaPerClick);
            
            // Update displays
            updateDisplay();
            
            // Check for evolution
            if (game.evolutionProgress >= game.evolutionThreshold) {
                // Future evolution mechanic placeholder
                // evolveCore();
            }
        });
        
        // Game loop - runs every 100ms (10 times per second)
        function gameLoop() {
            // Add mana per second / 10 (since we're updating 10 times per second)
            const manaGain = game.manaPerSecond / 10;
            game.mana += manaGain;
            game.totalMana += manaGain;
            game.evolutionProgress += manaGain;
            
            // Update displays
            updateDisplay();
            
            // Check for evolution
            if (game.evolutionProgress >= game.evolutionThreshold) {
                // Future evolution mechanic placeholder
                // evolveCore();
            }
        }
        
        // Initialize the game
        function init() {
            renderFeatures();
            updateDisplay();
            
            // Start the game loop
            setInterval(gameLoop, 100);
        }
        
        // Start the game
        init();
    </script>
</body>
</html>